
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://msk-mind.github.io/luna/reference/common/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-8.5.10">
    
    
      
        <title>Luna Common - luna: Multi-modality Oncology Data Analysis in Python</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#luna-common" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="luna: Multi-modality Oncology Data Analysis in Python" class="md-header__button md-logo" aria-label="luna: Multi-modality Oncology Data Analysis in Python" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            luna: Multi-modality Oncology Data Analysis in Python
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Luna Common
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/msk-mind/luna" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    msk-mind/luna
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="luna: Multi-modality Oncology Data Analysis in Python" class="md-nav__button md-logo" aria-label="luna: Multi-modality Oncology Data Analysis in Python" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    luna: Multi-modality Oncology Data Analysis in Python
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/msk-mind/luna" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    msk-mind/luna
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../user/" class="md-nav__link">
        User Guide
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../tutorials/">Tutorials</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/1_dataset-prep/" class="md-nav__link">
        Dataset Preparation Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/2_tiling-file/" class="md-nav__link">
        Tile Generation Tutorial (File Edition)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/2_tiling-waystation/" class="md-nav__link">
        Tile Generation Tutorial (Waystation edition)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/3_model-training/" class="md-nav__link">
        Model Training Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/4_inference-and-visualization/" class="md-nav__link">
        Inference and Visualization Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/5_end-to-end-pipeline/" class="md-nav__link">
        Snakemake End-To-End Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/6_dsa-tools/" class="md-nav__link">
        Digital Slide Archive (DSA) Visualization Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/7_dsa-annotation/" class="md-nav__link">
        DSA Annotation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/spatial_stats/" class="md-nav__link">
        Calculate and Visualize K-function Statistics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7">
          CLI Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CLI Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          CLI Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" type="checkbox" id="__nav_7_1" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_1">
          Pathology
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pathology" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Pathology
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/detect_tissue/" class="md-nav__link">
        detect_tissue
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/dsa/" class="md-nav__link">
        dsa
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/dsa_upload/" class="md-nav__link">
        dsa_upload
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/extract_shape_features/" class="md-nav__link">
        extract_shape_features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/extract_stain_texture/" class="md-nav__link">
        extract_stain_texture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/generate_mask/" class="md-nav__link">
        generate_mask
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/generate_tile_mask/" class="md-nav__link">
        generate_tile_mask
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/generate_tiles/" class="md-nav__link">
        generate_tiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/infer_tiles/" class="md-nav__link">
        infer_tiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/label_tiles/" class="md-nav__link">
        label_tiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/run_stardist_cell_detection/" class="md-nav__link">
        run_stardist_cell_detection
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/save_tiles/" class="md-nav__link">
        save_tiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/slide_etl/" class="md-nav__link">
        slide_etl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/pathology/visualize_tiles_png/" class="md-nav__link">
        visualize_tiles_png
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7_2">
          Radiology
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Radiology" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Radiology
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/radiology/coregister_volumes/" class="md-nav__link">
        coregister_volumes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/radiology/dicom_to_itk/" class="md-nav__link">
        dicom_to_itk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/radiology/extract_radiomics/" class="md-nav__link">
        extract_radiomics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/radiology/extract_voxels/" class="md-nav__link">
        extract_voxels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/radiology/generate_threshold_mask/" class="md-nav__link">
        generate_threshold_mask
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/radiology/match_metadata/" class="md-nav__link">
        match_metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/radiology/randomize_contours/" class="md-nav__link">
        randomize_contours
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/radiology/window_volume/" class="md-nav__link">
        window_volume
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cli_reference/radiology/xnat_etl/" class="md-nav__link">
        xnat_etl
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Luna Common
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Luna Common
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#luna.common" class="md-nav__link">
    common
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.adapters" class="md-nav__link">
    adapters
  </a>
  
    <nav class="md-nav" aria-label="adapters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.FileWriteAdatper" class="md-nav__link">
    FileWriteAdatper
  </a>
  
    <nav class="md-nav" aria-label="FileWriteAdatper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.FileWriteAdatper.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.FileWriteAdatper.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.IOAdapter" class="md-nav__link">
    IOAdapter
  </a>
  
    <nav class="md-nav" aria-label="IOAdapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.IOAdapter.writer" class="md-nav__link">
    writer()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.MinioWriteAdatper" class="md-nav__link">
    MinioWriteAdatper
  </a>
  
    <nav class="md-nav" aria-label="MinioWriteAdatper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.MinioWriteAdatper.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.MinioWriteAdatper.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.NoWriteAdapter" class="md-nav__link">
    NoWriteAdapter
  </a>
  
    <nav class="md-nav" aria-label="NoWriteAdapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.NoWriteAdapter.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.config" class="md-nav__link">
    config
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet" class="md-nav__link">
    ConfigSet
  </a>
  
    <nav class="md-nav" aria-label="ConfigSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.clear" class="md-nav__link">
    clear()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.get_config_set" class="md-nav__link">
    get_config_set()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.get_keys" class="md-nav__link">
    get_keys()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.get_names" class="md-nav__link">
    get_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.get_value" class="md-nav__link">
    get_value()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.has_value" class="md-nav__link">
    has_value()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.connectors" class="md-nav__link">
    connectors
  </a>
  
    <nav class="md-nav" aria-label="connectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.connectors.DremioClientAuthMiddleware" class="md-nav__link">
    DremioClientAuthMiddleware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.connectors.DremioClientAuthMiddlewareFactory" class="md-nav__link">
    DremioClientAuthMiddlewareFactory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.connectors.DremioDataframeConnector" class="md-nav__link">
    DremioDataframeConnector
  </a>
  
    <nav class="md-nav" aria-label="DremioDataframeConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.connectors.DremioDataframeConnector.get_table" class="md-nav__link">
    get_table()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.connectors.DremioDataframeConnector.run_query" class="md-nav__link">
    run_query()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.dask" class="md-nav__link">
    dask
  </a>
  
    <nav class="md-nav" aria-label="dask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.dask.configure_dask_client" class="md-nav__link">
    configure_dask_client()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.dask.dask_job" class="md-nav__link">
    dask_job()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.dask.prune_empty_delayed" class="md-nav__link">
    prune_empty_delayed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.dask.with_event_loop" class="md-nav__link">
    with_event_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.stats" class="md-nav__link">
    stats
  </a>
  
    <nav class="md-nav" aria-label="stats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.stats.compute_stats_1d" class="md-nav__link">
    compute_stats_1d()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliCall" class="md-nav__link">
    LunaCliCall
  </a>
  
    <nav class="md-nav" aria-label="LunaCliCall">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliCall.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliClient" class="md-nav__link">
    LunaCliClient
  </a>
  
    <nav class="md-nav" aria-label="LunaCliClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliClient.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliClient.bootstrap" class="md-nav__link">
    bootstrap()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliClient.configure" class="md-nav__link">
    configure()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliClient.get_output_dir" class="md-nav__link">
    get_output_dir()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.apply_csv_filter" class="md-nav__link">
    apply_csv_filter()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.generate_uuid" class="md-nav__link">
    generate_uuid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.generate_uuid_binary" class="md-nav__link">
    generate_uuid_binary()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.generate_uuid_dict" class="md-nav__link">
    generate_uuid_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.get_absolute_path" class="md-nav__link">
    get_absolute_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.get_config" class="md-nav__link">
    get_config()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.get_dataset_url" class="md-nav__link">
    get_dataset_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.grouper" class="md-nav__link">
    grouper()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.load_func" class="md-nav__link">
    load_func()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.local_cache_urlpath" class="md-nav__link">
    local_cache_urlpath()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.post_to_dataset" class="md-nav__link">
    post_to_dataset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.save_metadata" class="md-nav__link">
    save_metadata()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.timed" class="md-nav__link">
    timed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.validate_dask_address" class="md-nav__link">
    validate_dask_address()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pathology/" class="md-nav__link">
        Luna Pathology
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../radiology/" class="md-nav__link">
        Luna Radiology
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_9">
          Developers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dev/" class="md-nav__link">
        Development Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../publications/" class="md-nav__link">
        Publications
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../history/" class="md-nav__link">
        Release History
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#luna.common" class="md-nav__link">
    common
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.adapters" class="md-nav__link">
    adapters
  </a>
  
    <nav class="md-nav" aria-label="adapters">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.FileWriteAdatper" class="md-nav__link">
    FileWriteAdatper
  </a>
  
    <nav class="md-nav" aria-label="FileWriteAdatper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.FileWriteAdatper.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.FileWriteAdatper.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.IOAdapter" class="md-nav__link">
    IOAdapter
  </a>
  
    <nav class="md-nav" aria-label="IOAdapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.IOAdapter.writer" class="md-nav__link">
    writer()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.MinioWriteAdatper" class="md-nav__link">
    MinioWriteAdatper
  </a>
  
    <nav class="md-nav" aria-label="MinioWriteAdatper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.MinioWriteAdatper.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.MinioWriteAdatper.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.NoWriteAdapter" class="md-nav__link">
    NoWriteAdapter
  </a>
  
    <nav class="md-nav" aria-label="NoWriteAdapter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.adapters.NoWriteAdapter.write" class="md-nav__link">
    write()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.config" class="md-nav__link">
    config
  </a>
  
    <nav class="md-nav" aria-label="config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet" class="md-nav__link">
    ConfigSet
  </a>
  
    <nav class="md-nav" aria-label="ConfigSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.clear" class="md-nav__link">
    clear()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.get_config_set" class="md-nav__link">
    get_config_set()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.get_keys" class="md-nav__link">
    get_keys()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.get_names" class="md-nav__link">
    get_names()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.get_value" class="md-nav__link">
    get_value()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.config.ConfigSet.has_value" class="md-nav__link">
    has_value()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.connectors" class="md-nav__link">
    connectors
  </a>
  
    <nav class="md-nav" aria-label="connectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.connectors.DremioClientAuthMiddleware" class="md-nav__link">
    DremioClientAuthMiddleware
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.connectors.DremioClientAuthMiddlewareFactory" class="md-nav__link">
    DremioClientAuthMiddlewareFactory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.connectors.DremioDataframeConnector" class="md-nav__link">
    DremioDataframeConnector
  </a>
  
    <nav class="md-nav" aria-label="DremioDataframeConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.connectors.DremioDataframeConnector.get_table" class="md-nav__link">
    get_table()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.connectors.DremioDataframeConnector.run_query" class="md-nav__link">
    run_query()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.dask" class="md-nav__link">
    dask
  </a>
  
    <nav class="md-nav" aria-label="dask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.dask.configure_dask_client" class="md-nav__link">
    configure_dask_client()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.dask.dask_job" class="md-nav__link">
    dask_job()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.dask.prune_empty_delayed" class="md-nav__link">
    prune_empty_delayed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.dask.with_event_loop" class="md-nav__link">
    with_event_loop()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.stats" class="md-nav__link">
    stats
  </a>
  
    <nav class="md-nav" aria-label="stats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.stats.compute_stats_1d" class="md-nav__link">
    compute_stats_1d()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna.common.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliCall" class="md-nav__link">
    LunaCliCall
  </a>
  
    <nav class="md-nav" aria-label="LunaCliCall">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliCall.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliClient" class="md-nav__link">
    LunaCliClient
  </a>
  
    <nav class="md-nav" aria-label="LunaCliClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliClient.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliClient.bootstrap" class="md-nav__link">
    bootstrap()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliClient.configure" class="md-nav__link">
    configure()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.LunaCliClient.get_output_dir" class="md-nav__link">
    get_output_dir()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.apply_csv_filter" class="md-nav__link">
    apply_csv_filter()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.generate_uuid" class="md-nav__link">
    generate_uuid()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.generate_uuid_binary" class="md-nav__link">
    generate_uuid_binary()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.generate_uuid_dict" class="md-nav__link">
    generate_uuid_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.get_absolute_path" class="md-nav__link">
    get_absolute_path()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.get_config" class="md-nav__link">
    get_config()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.get_dataset_url" class="md-nav__link">
    get_dataset_url()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.grouper" class="md-nav__link">
    grouper()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.load_func" class="md-nav__link">
    load_func()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.local_cache_urlpath" class="md-nav__link">
    local_cache_urlpath()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.post_to_dataset" class="md-nav__link">
    post_to_dataset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.save_metadata" class="md-nav__link">
    save_metadata()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.timed" class="md-nav__link">
    timed()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#luna.common.utils.validate_dask_address" class="md-nav__link">
    validate_dask_address()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/msk-mind/luna/edit/master/docs/reference/common.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="luna-common">Luna Common<a class="headerlink" href="#luna-common" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="luna.common"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-module">




<h2 id="luna.common.adapters" class="doc doc-heading">
          <code>adapters</code>


<a href="#luna.common.adapters" class="headerlink" title="Permanent link">&para;</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h3 id="luna.common.adapters.FileWriteAdatper" class="doc doc-heading">
          <code>FileWriteAdatper</code>


<a href="#luna.common.adapters.FileWriteAdatper" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="luna.common.adapters.WriteAdapter">WriteAdapter</span></code></p>


            <details class="quote">
              <summary>Source code in <code>src/luna/common/adapters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="k">class</span> <span class="nc">FileWriteAdatper</span><span class="p">(</span><span class="n">WriteAdapter</span><span class="p">):</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="p">):</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a WriteAdapter for a given file I/O scheme and URL</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            store_url (str): root URL for the storage location (e.g. s3://localhost:9000 or file:///data)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            bucket (str): the &quot;bucket&quot; or &quot;parent folder&quot; for the storage location</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">url_result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">store_url</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="c1"># All we need is the base path</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_path</span> <span class="o">=</span> <span class="n">url_result</span><span class="o">.</span><span class="n">path</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">bucket</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="c1"># Define base URL</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;file://</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Configured FileAdatper with base URL=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available buckets:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform write operation to a posix file system</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        Will not perform write if :</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            the content length matches (full copy) and the input modification time is earlier than the ingest time (with a 1 min. grace period)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            input_data (str): path to input file</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            prefix (str): relative path prefix for destination</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">            dict: key-value pairs containing metadata about the write operation</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">prefix_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">input_path</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_path</span><span class="p">):</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">if</span> <span class="n">prefix_path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="s2">&quot;Prefix paths must be relative!&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="p">)</span>  <span class="c1"># User needs to know prefixes are relative paths</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">output_data_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">output_data</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">input_size</span><span class="p">,</span> <span class="n">input_mtime</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">output_size</span><span class="p">,</span> <span class="n">output_mtime</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">needs_write</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">output_size</span> <span class="o">!=</span> <span class="n">input_size</span> <span class="ow">or</span> <span class="p">(</span><span class="n">input_mtime</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">output_mtime</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="p">)</span>  <span class="c1"># 60 second grace period</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="k">if</span> <span class="n">needs_write</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">output_data</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">output_size</span><span class="p">,</span> <span class="n">output_mtime</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">output_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="s2">&quot;data_url&quot;</span><span class="p">:</span> <span class="n">output_data_url</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">output_size</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="s2">&quot;ingest_time&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">output_mtime</span><span class="p">),</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h4 id="luna.common.adapters.FileWriteAdatper.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="p">)</span></code>

<a href="#luna.common.adapters.FileWriteAdatper.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Return a WriteAdapter for a given file I/O scheme and URL</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>store_url</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>root URL for the storage location (e.g. s3://localhost:9000 or file:///data)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bucket</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the "bucket" or "parent folder" for the storage location</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/adapters.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="p">):</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a WriteAdapter for a given file I/O scheme and URL</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        store_url (str): root URL for the storage location (e.g. s3://localhost:9000 or file:///data)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        bucket (str): the &quot;bucket&quot; or &quot;parent folder&quot; for the storage location</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">url_result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">store_url</span><span class="p">)</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="c1"># All we need is the base path</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">store_path</span> <span class="o">=</span> <span class="n">url_result</span><span class="o">.</span><span class="n">path</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">bucket</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="c1"># Define base URL</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;file://</span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Configured FileAdatper with base URL=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available buckets:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.adapters.FileWriteAdatper.write" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span></code>

<a href="#luna.common.adapters.FileWriteAdatper.write" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Perform write operation to a posix file system</p>

<details class="will-not-perform-write-if-" open>
  <summary>Will not perform write if</summary>
  <p>the content length matches (full copy) and the input modification time is earlier than the ingest time (with a 1 min. grace period)</p>
</details>


  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_data</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to input file</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>relative path prefix for destination</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns:
    dict: key-value pairs containing metadata about the write operation</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/adapters.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform write operation to a posix file system</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    Will not perform write if :</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        the content length matches (full copy) and the input modification time is earlier than the ingest time (with a 1 min. grace period)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        input_data (str): path to input file</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        prefix (str): relative path prefix for destination</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        dict: key-value pairs containing metadata about the write operation</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">prefix_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="n">input_path</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_path</span><span class="p">):</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">if</span> <span class="n">prefix_path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="s2">&quot;Prefix paths must be relative!&quot;</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="p">)</span>  <span class="c1"># User needs to know prefixes are relative paths</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">output_data_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">store_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">output_data</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">input_size</span><span class="p">,</span> <span class="n">input_mtime</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="n">output_size</span><span class="p">,</span> <span class="n">output_mtime</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">needs_write</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">output_size</span> <span class="o">!=</span> <span class="n">input_size</span> <span class="ow">or</span> <span class="p">(</span><span class="n">input_mtime</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">output_mtime</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="p">)</span>  <span class="c1"># 60 second grace period</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">if</span> <span class="n">needs_write</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">output_data</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">output_size</span><span class="p">,</span> <span class="n">output_mtime</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">output_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="s2">&quot;data_url&quot;</span><span class="p">:</span> <span class="n">output_data_url</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">output_size</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="s2">&quot;ingest_time&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">output_mtime</span><span class="p">),</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h3 id="luna.common.adapters.IOAdapter" class="doc doc-heading">
          <code>IOAdapter</code>


<a href="#luna.common.adapters.IOAdapter" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">

  
      <p>Interface for IO</p>
<p>Exposes a write and read method via scheme specific classes:</p>
<p>IOAdapter.writer(<scheme>).write(<data>) -&gt; url</p>
<p>IOAdapter.reader(<scheme>).read(<url>)   -&gt; data (TODO)</p>

            <details class="quote">
              <summary>Source code in <code>src/luna/common/adapters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="k">class</span> <span class="nc">IOAdapter</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface for IO</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    Exposes a write and read method via scheme specific classes:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    IOAdapter.writer(&lt;scheme&gt;).write(&lt;data&gt;) -&gt; url</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    IOAdapter.reader(&lt;scheme&gt;).read(&lt;url&gt;)   -&gt; data (TODO)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">no_write</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">no_write</span> <span class="o">=</span> <span class="n">no_write</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="k">def</span> <span class="nf">writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="p">):</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a WriteAdapter for a given file I/O scheme and URL</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">            store_url (str): root URL for the storage location (e.g. s3://localhost:9000 or file:///data)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">            bucket (str): the &quot;bucket&quot; or &quot;parent folder&quot; for the storage location</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        Returns</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">            WriteAdapter: object capable of writing to the location at store_url</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_write</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="k">return</span> <span class="n">NoWriteAdapter</span><span class="p">()</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="n">url_result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">store_url</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">if</span> <span class="n">url_result</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="k">return</span> <span class="n">FileWriteAdatper</span><span class="p">(</span><span class="n">store_url</span><span class="o">=</span><span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="k">elif</span> <span class="n">url_result</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;s3&quot;</span><span class="p">:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="k">return</span> <span class="n">MinioWriteAdatper</span><span class="p">(</span><span class="n">store_url</span><span class="o">=</span><span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="k">elif</span> <span class="n">url_result</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;s3+https&quot;</span><span class="p">:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="k">return</span> <span class="n">MinioWriteAdatper</span><span class="p">(</span><span class="n">store_url</span><span class="o">=</span><span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">secure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>                <span class="s2">&quot;Unsupported slide store schemes, please try s3:// or file://&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h4 id="luna.common.adapters.IOAdapter.writer" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">writer</span><span class="p">(</span><span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="p">)</span></code>

<a href="#luna.common.adapters.IOAdapter.writer" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Return a WriteAdapter for a given file I/O scheme and URL</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>store_url</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>root URL for the storage location (e.g. s3://localhost:9000 or file:///data)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bucket</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the "bucket" or "parent folder" for the storage location</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns
    WriteAdapter: object capable of writing to the location at store_url</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/adapters.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="k">def</span> <span class="nf">writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="p">):</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a WriteAdapter for a given file I/O scheme and URL</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        store_url (str): root URL for the storage location (e.g. s3://localhost:9000 or file:///data)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        bucket (str): the &quot;bucket&quot; or &quot;parent folder&quot; for the storage location</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        WriteAdapter: object capable of writing to the location at store_url</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">no_write</span><span class="p">:</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="k">return</span> <span class="n">NoWriteAdapter</span><span class="p">()</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="n">url_result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">store_url</span><span class="p">)</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="k">if</span> <span class="n">url_result</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="k">return</span> <span class="n">FileWriteAdatper</span><span class="p">(</span><span class="n">store_url</span><span class="o">=</span><span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="k">elif</span> <span class="n">url_result</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;s3&quot;</span><span class="p">:</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">return</span> <span class="n">MinioWriteAdatper</span><span class="p">(</span><span class="n">store_url</span><span class="o">=</span><span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="k">elif</span> <span class="n">url_result</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;s3+https&quot;</span><span class="p">:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="k">return</span> <span class="n">MinioWriteAdatper</span><span class="p">(</span><span class="n">store_url</span><span class="o">=</span><span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">secure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="s2">&quot;Unsupported slide store schemes, please try s3:// or file://&quot;</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h3 id="luna.common.adapters.MinioWriteAdatper" class="doc doc-heading">
          <code>MinioWriteAdatper</code>


<a href="#luna.common.adapters.MinioWriteAdatper" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="luna.common.adapters.WriteAdapter">WriteAdapter</span></code></p>


            <details class="quote">
              <summary>Source code in <code>src/luna/common/adapters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="k">class</span> <span class="nc">MinioWriteAdatper</span><span class="p">(</span><span class="n">WriteAdapter</span><span class="p">):</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">secure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a WriteAdapter for a given file I/O scheme and URL</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">            store_url (str): root URL for the storage location (e.g. s3://localhost:9000 or file:///data)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">            bucket (str): the &quot;bucket&quot; or &quot;parent folder&quot; for the storage location</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">url_result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">store_url</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="c1"># We need a bit more detail here</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_hostname</span> <span class="o">=</span> <span class="n">url_result</span><span class="o">.</span><span class="n">hostname</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_port</span> <span class="o">=</span> <span class="n">url_result</span><span class="o">.</span><span class="n">port</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">bucket</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">secure</span> <span class="o">=</span> <span class="n">secure</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client_init</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">Minio</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">store_hostname</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">store_port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">access_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MINIO_USER&quot;</span><span class="p">],</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">secret_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MINIO_PASSWORD&quot;</span><span class="p">],</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">secure</span><span class="o">=</span><span class="n">secure</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">store_hostname</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">store_port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Configured MinioAdatper with base URL=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_init</span><span class="p">()</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available buckets:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">():</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform write operation to a s3 file system</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">        Will not perform write if :</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">            the content length matches (full copy) and the input modification time is earlier than the ingest time (with a 1 min. grace period)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">            input_data (str): path to input file</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">            prefix (str): relative path prefix for destination</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">            dict: key-value pairs containing metadata about the write operation</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">prefix_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="n">input_path</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_path</span><span class="p">):</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="k">if</span> <span class="n">prefix_path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="s2">&quot;Prefix paths must be relative!&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="p">)</span>  <span class="c1"># User needs to know prefixes are relative paths</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">output_data_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_init</span><span class="p">()</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="n">object_size</span><span class="p">,</span> <span class="n">object_mtime</span> <span class="o">=</span> <span class="n">get_object_stats</span><span class="p">(</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="p">)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">input_size</span><span class="p">,</span> <span class="n">input_mtime</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">needs_write</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="n">object_size</span> <span class="o">!=</span> <span class="n">input_size</span> <span class="ow">or</span> <span class="p">(</span><span class="n">input_mtime</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">object_mtime</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="p">)</span>  <span class="c1"># 60 second grace period</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">if</span> <span class="n">needs_write</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">client</span><span class="o">.</span><span class="n">fput_object</span><span class="p">(</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="n">input_path</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="n">part_size</span><span class="o">=</span><span class="mi">250000000</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="p">)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">object_size</span><span class="p">,</span> <span class="n">object_mtime</span> <span class="o">=</span> <span class="n">get_object_stats</span><span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">object_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="s2">&quot;data_url&quot;</span><span class="p">:</span> <span class="n">output_data_url</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">object_size</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="s2">&quot;ingest_time&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">object_mtime</span><span class="p">),</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h4 id="luna.common.adapters.MinioWriteAdatper.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">secure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#luna.common.adapters.MinioWriteAdatper.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Return a WriteAdapter for a given file I/O scheme and URL</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>store_url</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>root URL for the storage location (e.g. s3://localhost:9000 or file:///data)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bucket</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the "bucket" or "parent folder" for the storage location</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/adapters.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store_url</span><span class="p">,</span> <span class="n">bucket</span><span class="p">,</span> <span class="n">secure</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a WriteAdapter for a given file I/O scheme and URL</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        store_url (str): root URL for the storage location (e.g. s3://localhost:9000 or file:///data)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        bucket (str): the &quot;bucket&quot; or &quot;parent folder&quot; for the storage location</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="n">url_result</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">store_url</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="c1"># We need a bit more detail here</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">store_hostname</span> <span class="o">=</span> <span class="n">url_result</span><span class="o">.</span><span class="n">hostname</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">store_port</span> <span class="o">=</span> <span class="n">url_result</span><span class="o">.</span><span class="n">port</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">bucket</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">secure</span> <span class="o">=</span> <span class="n">secure</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">client_init</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="n">Minio</span><span class="p">,</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">store_hostname</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">store_port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">access_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MINIO_USER&quot;</span><span class="p">],</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="n">secret_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MINIO_PASSWORD&quot;</span><span class="p">],</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="n">secure</span><span class="o">=</span><span class="n">secure</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;s3://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">store_hostname</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">store_port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Configured MinioAdatper with base URL=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_init</span><span class="p">()</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available buckets:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">client</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">():</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.adapters.MinioWriteAdatper.write" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span></code>

<a href="#luna.common.adapters.MinioWriteAdatper.write" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Perform write operation to a s3 file system</p>

<details class="will-not-perform-write-if-" open>
  <summary>Will not perform write if</summary>
  <p>the content length matches (full copy) and the input modification time is earlier than the ingest time (with a 1 min. grace period)</p>
</details>


  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_data</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to input file</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>relative path prefix for destination</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns:
    dict: key-value pairs containing metadata about the write operation</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/adapters.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform write operation to a s3 file system</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    Will not perform write if :</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        the content length matches (full copy) and the input modification time is earlier than the ingest time (with a 1 min. grace period)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        input_data (str): path to input file</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        prefix (str): relative path prefix for destination</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        dict: key-value pairs containing metadata about the write operation</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="n">prefix_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="n">input_path</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_path</span><span class="p">):</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">if</span> <span class="n">prefix_path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="s2">&quot;Prefix paths must be relative!&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="p">)</span>  <span class="c1"># User needs to know prefixes are relative paths</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">output_data_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_init</span><span class="p">()</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">object_size</span><span class="p">,</span> <span class="n">object_mtime</span> <span class="o">=</span> <span class="n">get_object_stats</span><span class="p">(</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="p">)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">input_size</span><span class="p">,</span> <span class="n">input_mtime</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">needs_write</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">object_size</span> <span class="o">!=</span> <span class="n">input_size</span> <span class="ow">or</span> <span class="p">(</span><span class="n">input_mtime</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">object_mtime</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="p">)</span>  <span class="c1"># 60 second grace period</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">if</span> <span class="n">needs_write</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="n">client</span><span class="o">.</span><span class="n">fput_object</span><span class="p">(</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>            <span class="n">input_path</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="n">part_size</span><span class="o">=</span><span class="mi">250000000</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="p">)</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="n">object_size</span><span class="p">,</span> <span class="n">object_mtime</span> <span class="o">=</span> <span class="n">get_object_stats</span><span class="p">(</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">object_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="s2">&quot;data_url&quot;</span><span class="p">:</span> <span class="n">output_data_url</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">object_size</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="s2">&quot;ingest_time&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">object_mtime</span><span class="p">),</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h3 id="luna.common.adapters.NoWriteAdapter" class="doc doc-heading">
          <code>NoWriteAdapter</code>


<a href="#luna.common.adapters.NoWriteAdapter" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="luna.common.adapters.WriteAdapter">WriteAdapter</span></code></p>


            <details class="quote">
              <summary>Source code in <code>src/luna/common/adapters.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="k">class</span> <span class="nc">NoWriteAdapter</span><span class="p">(</span><span class="n">WriteAdapter</span><span class="p">):</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;file://&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Configured NoWriteAdatper with base URL=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="p">)</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns input_data as written data</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">            input_data (str): path to input file</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">            prefix (str): relative path prefix for destination, ignored</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">            dict: key-value pairs containing metadata about the write operation</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="c1"># filename = input_path.name</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_path</span><span class="p">):</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="n">output_data_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}{</span><span class="n">input_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">input_size</span><span class="p">,</span> <span class="n">input_mtime</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="s2">&quot;data_url&quot;</span><span class="p">:</span> <span class="n">output_data_url</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">input_size</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="s2">&quot;ingest_time&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">input_mtime</span><span class="p">),</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h4 id="luna.common.adapters.NoWriteAdapter.write" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">write</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span></code>

<a href="#luna.common.adapters.NoWriteAdapter.write" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Returns input_data as written data</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_data</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to input file</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>relative path prefix for destination, ignored</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns:
    dict: key-value pairs containing metadata about the write operation</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/adapters.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns input_data as written data</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        input_data (str): path to input file</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        prefix (str): relative path prefix for destination, ignored</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        dict: key-value pairs containing metadata about the write operation</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="c1"># filename = input_path.name</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_path</span><span class="p">):</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="k">return</span> <span class="p">{}</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="n">output_data_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}{</span><span class="n">input_path</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">input_size</span><span class="p">,</span> <span class="n">input_mtime</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="s2">&quot;readable&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="s2">&quot;data_url&quot;</span><span class="p">:</span> <span class="n">output_data_url</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">input_size</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="s2">&quot;ingest_time&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">input_mtime</span><span class="p">),</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">




<h2 id="luna.common.config" class="doc doc-heading">
          <code>config</code>


<a href="#luna.common.config" class="headerlink" title="Permanent link">&para;</a></h2>

  <div class="doc doc-contents ">
  
      <p>Created on October 17, 2019</p>
<p>@author: pashaa@mskcc.org</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h3 id="luna.common.config.ConfigSet" class="doc doc-heading">
          <code>ConfigSet</code>


<a href="#luna.common.config.ConfigSet" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">

  
      <p>This is a singleton class that can load a collection of configurations from yaml files.</p>
<p>ConfigSet loads configurations from yaml files only once on first invocation of this class with
the specified yaml file. The class then maintains the configuration in memory in a singleton instance. All new
invocations of this class will serve up the same configuration.</p>
<p>Each configuration in the collection is identified by a logical name.</p>
<p>If a new invocation of this class is created with an existing logical name and a different yaml file, the singleton
instance replaces the existing configuration with the newly specified yaml file for the given logical name.</p>

            <details class="quote">
              <summary>Source code in <code>src/luna/common/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">class</span> <span class="nc">ConfigSet</span><span class="p">:</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    This is a singleton class that can load a collection of configurations from yaml files.</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    ConfigSet loads configurations from yaml files only once on first invocation of this class with</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    the specified yaml file. The class then maintains the configuration in memory in a singleton instance. All new</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    invocations of this class will serve up the same configuration.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Each configuration in the collection is identified by a logical name.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    If a new invocation of this class is created with an existing logical name and a different yaml file, the singleton</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    instance replaces the existing configuration with the newly specified yaml file for the given logical name.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">__CONFIG_MAP</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># maps logical name to yaml config file name</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">__SCHEMA_MAP</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># maps logical name to schema file of yaml config file</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">__INSTANCE</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># singleton instance containing the collection of configs keyed by logical name</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">schema_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="c1"># assume one or more collections have already been loaded</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">config_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="k">return</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="c1"># initialize singleton</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="k">if</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="c1"># load or reload config into memory</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__CONFIG_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="ow">or</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__CONFIG_MAP</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">!=</span> <span class="n">config_file</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="p">):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__CONFIG_MAP</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_file</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">_load_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="c1"># add schema and validate config</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="k">if</span> <span class="n">schema_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>                <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__SCHEMA_MAP</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema_file</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>                <span class="n">ConfigSet</span><span class="o">.</span><span class="n">_validate_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="k">return</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">schema_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        :param name logical name to be given for this configuration. This argument only needs to be provided on first</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">                    invocation (optional).</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        :param config_file the config file to load. This argument only needs to be provided on first</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                           invocation (optional).</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        :param schema_file a schema file for the yaml configuration (optional)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        :raises yamale.yamale_error.YamaleError if config file is invalid when validated against the schema</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="k">pass</span>  <span class="c1"># see __new__() method implementation</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="k">def</span> <span class="nf">_validate_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__CONFIG_MAP</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">schema_file</span> <span class="o">=</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__SCHEMA_MAP</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="s2">&quot;validating config &quot;</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="o">+</span> <span class="n">config_file</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="o">+</span> <span class="s2">&quot; against schema &quot;</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="o">+</span> <span class="n">schema_file</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="o">+</span> <span class="s2">&quot; for &quot;</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="o">+</span> <span class="n">name</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="p">)</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">yamale</span><span class="o">.</span><span class="n">make_schema</span><span class="p">(</span><span class="n">schema_file</span><span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">yamale</span><span class="o">.</span><span class="n">make_data</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">yamale</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">def</span> <span class="nf">_load_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        :param name: logical name of the config to load</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        :return: config generator object</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        :raises: IOError if yaml config file for the specified logical name cannot be found</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="c1"># read config file</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">config_file</span> <span class="o">=</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__CONFIG_MAP</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;loading config file &quot;</span> <span class="o">+</span> <span class="n">config_file</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">stream</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>                <span class="s2">&quot;unable to find a config file with name &quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>                <span class="o">+</span> <span class="n">config_file</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>                <span class="o">+</span> <span class="s2">&quot;. Please use config.yaml.template to make a &quot;</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="o">+</span> <span class="n">config_file</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="o">+</span> <span class="s2">&quot;. &quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="k">raise</span> <span class="n">err</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="k">for</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load_all</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">):</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">return</span> <span class="n">config</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">def</span> <span class="nf">_parse_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">path_segments</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;::&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># split just once</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_segments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                <span class="s2">&quot;Illegal config path: &quot;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;. must be of form &quot;name::jsonpath&quot; &#39;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="s2">&quot;where name is the logical name of the configuration and jsonpath is the &quot;</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="s2">&quot;jsonpath into the yaml configuration&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">path_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;jsonpath&quot;</span><span class="p">:</span> <span class="n">path_segments</span><span class="p">[</span><span class="mi">1</span><span class="p">]}</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">def</span> <span class="nf">_get_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">jsonpath</span><span class="p">):</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">jsonpath_expression</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">jsonpath</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">return</span> <span class="n">jsonpath_expression</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">def</span> <span class="nf">has_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">            path (str): path to a value in a configuration. The path must be of the form</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">            &quot;name::jsonpath&quot; where name is the logical name of the configuration and jsonpath is the jsonpath to value.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">            see config.yaml to generate a jsonpath. See https://pypi.org/project/jsonpath-ng/ jsonpath expressions</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">            may be tested here - https://jsonpath.com/</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">            boolean: true if value is not an empty string, else false.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">            ValueError: if a configuration with the specified name was never loaded</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">jsonpath</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;jsonpath&quot;</span><span class="p">]</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="p">):</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>                <span class="s2">&quot;configuration with logical name &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; was never loaded&quot;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_match</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">jsonpath</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        Gets the value for the specified jsonpath from the specified configuration.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">            path (str): path to a value in a configuration. The path must be of the form &quot;name::jsonpath&quot;</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">            where name is the logical name of the configuration and jsonpath is the jsonpath to value.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">            see config.yaml to generate a jsonpath. See https://pypi.org/project/jsonpath-ng/</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">            jsonpath expressions may be tested here - https://jsonpath.com/</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">            str: value from config file</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">            ValueError: if no match is found for the specified exception or a configuration with</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">            the specified name was never loaded</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">jsonpath</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;jsonpath&quot;</span><span class="p">]</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="p">):</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="s2">&quot;configuration with logical name &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; was never loaded&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_match</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">jsonpath</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;unable to find a config value for jsonpath: &quot;</span> <span class="o">+</span> <span class="n">jsonpath</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="k">return</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">def</span> <span class="nf">get_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        :return: a list of logical names of the configs stored in this instance.</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">if</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="k">return</span> <span class="p">[]</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="k">def</span> <span class="nf">get_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        :param name: logical name of the configuration</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        :return: a list of top-level keys in the config stored in this instance.</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        :raises: ValueError if a configuration with the specified name was never loaded</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="p">):</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="s2">&quot;configuration with logical name &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; was never loaded&quot;</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="k">def</span> <span class="nf">get_config_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">        :param name: logical name of the configuration</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        :return: a dictonary of top-level keys in the config stored in this instance.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        :raises: ValueError if a configuration with the specified name was never loaded</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>            <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="p">):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                <span class="s2">&quot;configuration with logical name &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; was never loaded&quot;</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="k">return</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">        clear the entire collection of configurations</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__CONFIG_MAP</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__SCHEMA_MAP</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h4 id="luna.common.config.ConfigSet.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">schema_file</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#luna.common.config.ConfigSet.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>:param name logical name to be given for this configuration. This argument only needs to be provided on first
            invocation (optional).
:param config_file the config file to load. This argument only needs to be provided on first
                   invocation (optional).
:param schema_file a schema file for the yaml configuration (optional)
:raises yamale.yamale_error.YamaleError if config file is invalid when validated against the schema</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/config.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">schema_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    :param name logical name to be given for this configuration. This argument only needs to be provided on first</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">                invocation (optional).</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    :param config_file the config file to load. This argument only needs to be provided on first</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                       invocation (optional).</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    :param schema_file a schema file for the yaml configuration (optional)</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    :raises yamale.yamale_error.YamaleError if config file is invalid when validated against the schema</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="k">pass</span>  <span class="c1"># see __new__() method implementation</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.config.ConfigSet.clear" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">clear</span><span class="p">()</span></code>

<a href="#luna.common.config.ConfigSet.clear" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>clear the entire collection of configurations</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/config.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    clear the entire collection of configurations</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__CONFIG_MAP</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__SCHEMA_MAP</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.config.ConfigSet.get_config_set" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_config_set</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#luna.common.config.ConfigSet.get_config_set" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>:param name: logical name of the configuration
:return: a dictonary of top-level keys in the config stored in this instance.
:raises: ValueError if a configuration with the specified name was never loaded</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/config.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="k">def</span> <span class="nf">get_config_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    :param name: logical name of the configuration</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    :return: a dictonary of top-level keys in the config stored in this instance.</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    :raises: ValueError if a configuration with the specified name was never loaded</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="p">):</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="s2">&quot;configuration with logical name &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; was never loaded&quot;</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="k">return</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.config.ConfigSet.get_keys" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_keys</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

<a href="#luna.common.config.ConfigSet.get_keys" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>:param name: logical name of the configuration
:return: a list of top-level keys in the config stored in this instance.
:raises: ValueError if a configuration with the specified name was never loaded</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/config.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="k">def</span> <span class="nf">get_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">    :param name: logical name of the configuration</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    :return: a list of top-level keys in the config stored in this instance.</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">    :raises: ValueError if a configuration with the specified name was never loaded</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="p">):</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="s2">&quot;configuration with logical name &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; was never loaded&quot;</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.config.ConfigSet.get_names" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_names</span><span class="p">()</span></code>

<a href="#luna.common.config.ConfigSet.get_names" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>:return: a list of logical names of the configs stored in this instance.</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/config.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="k">def</span> <span class="nf">get_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    :return: a list of logical names of the configs stored in this instance.</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">if</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.config.ConfigSet.get_value" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_value</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

<a href="#luna.common.config.ConfigSet.get_value" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Gets the value for the specified jsonpath from the specified configuration.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to a value in a configuration. The path must be of the form "name::jsonpath"</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>see</code></td>
          <td>
                <code>config.yaml to generate a jsonpath. See https</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>//pypi.org/project/jsonpath-ng/</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>jsonpath</code></td>
          <td>
                <code>expressions may be tested here - https</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>//jsonpath.com/</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>str</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>value from config file</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if no match is found for the specified exception or a configuration with</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/config.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">    Gets the value for the specified jsonpath from the specified configuration.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        path (str): path to a value in a configuration. The path must be of the form &quot;name::jsonpath&quot;</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        where name is the logical name of the configuration and jsonpath is the jsonpath to value.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        see config.yaml to generate a jsonpath. See https://pypi.org/project/jsonpath-ng/</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">        jsonpath expressions may be tested here - https://jsonpath.com/</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        str: value from config file</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        ValueError: if no match is found for the specified exception or a configuration with</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        the specified name was never loaded</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">jsonpath</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;jsonpath&quot;</span><span class="p">]</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="p">):</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="s2">&quot;configuration with logical name &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; was never loaded&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="p">)</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_match</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">jsonpath</span><span class="p">)</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="n">err</span> <span class="o">=</span> <span class="s2">&quot;unable to find a config value for jsonpath: &quot;</span> <span class="o">+</span> <span class="n">jsonpath</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="k">return</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.config.ConfigSet.has_value" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">has_value</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

<a href="#luna.common.config.ConfigSet.has_value" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to a value in a configuration. The path must be of the form</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>&#34;name</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>:jsonpath" where name is the logical name of the configuration and jsonpath is the jsonpath to value.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>see</code></td>
          <td>
                <code>config.yaml to generate a jsonpath. See https</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>//pypi.org/project/jsonpath-ng/ jsonpath expressions</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>may</code></td>
          <td>
                <code>be tested here - https</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>//jsonpath.com/</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>boolean</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>true if value is not an empty string, else false.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>if a configuration with the specified name was never loaded</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/config.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="k">def</span> <span class="nf">has_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        path (str): path to a value in a configuration. The path must be of the form</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">        &quot;name::jsonpath&quot; where name is the logical name of the configuration and jsonpath is the jsonpath to value.</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        see config.yaml to generate a jsonpath. See https://pypi.org/project/jsonpath-ng/ jsonpath expressions</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        may be tested here - https://jsonpath.com/</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        boolean: true if value is not an empty string, else false.</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">        ValueError: if a configuration with the specified name was never loaded</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="n">jsonpath</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">[</span><span class="s2">&quot;jsonpath&quot;</span><span class="p">]</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ConfigSet</span><span class="o">.</span><span class="n">__INSTANCE</span><span class="o">.</span><span class="n">__config</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="p">):</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="s2">&quot;configuration with logical name &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; was never loaded&quot;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_match</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">jsonpath</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">




<h2 id="luna.common.connectors" class="doc doc-heading">
          <code>connectors</code>


<a href="#luna.common.connectors" class="headerlink" title="Permanent link">&para;</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h3 id="luna.common.connectors.DremioClientAuthMiddleware" class="doc doc-heading">
          <code>DremioClientAuthMiddleware</code>


<a href="#luna.common.connectors.DremioClientAuthMiddleware" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pyarrow.flight.ClientMiddleware">ClientMiddleware</span></code></p>

  
      <p>A ClientMiddleware that extracts the bearer token from
the authorization header returned by the Dremio
Flight Server Endpoint.
Parameters</p>
<hr />
<p>factory : ClientHeaderAuthMiddlewareFactory
    The factory to set call credentials if an
    authorization header with bearer token is
    returned by the Dremio server.</p>

            <details class="quote">
              <summary>Source code in <code>src/luna/common/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="k">class</span> <span class="nc">DremioClientAuthMiddleware</span><span class="p">(</span><span class="n">flight</span><span class="o">.</span><span class="n">ClientMiddleware</span><span class="p">):</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    A ClientMiddleware that extracts the bearer token from</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    the authorization header returned by the Dremio</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    Flight Server Endpoint.</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    factory : ClientHeaderAuthMiddlewareFactory</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        The factory to set call credentials if an</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        authorization header with bearer token is</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        returned by the Dremio server.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factory</span><span class="p">):</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">factory</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="k">def</span> <span class="nf">received_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="n">auth_header_key</span> <span class="o">=</span> <span class="s2">&quot;authorization&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="n">authorization_header</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">auth_header_key</span><span class="p">:</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>                <span class="n">authorization_header</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">auth_header_key</span><span class="p">)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">set_call_credential</span><span class="p">(</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>            <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;authorization&quot;</span><span class="p">,</span> <span class="n">authorization_header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)]</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h3 id="luna.common.connectors.DremioClientAuthMiddlewareFactory" class="doc doc-heading">
          <code>DremioClientAuthMiddlewareFactory</code>


<a href="#luna.common.connectors.DremioClientAuthMiddlewareFactory" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="pyarrow.flight.ClientMiddlewareFactory">ClientMiddlewareFactory</span></code></p>

  
      <p>A factory that creates DremioClientAuthMiddleware(s).</p>

            <details class="quote">
              <summary>Source code in <code>src/luna/common/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="k">class</span> <span class="nc">DremioClientAuthMiddlewareFactory</span><span class="p">(</span><span class="n">flight</span><span class="o">.</span><span class="n">ClientMiddlewareFactory</span><span class="p">):</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A factory that creates DremioClientAuthMiddleware(s).&quot;&quot;&quot;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">call_credential</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="k">def</span> <span class="nf">start_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>        <span class="k">return</span> <span class="n">DremioClientAuthMiddleware</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="k">def</span> <span class="nf">set_call_credential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_credential</span><span class="p">):</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">call_credential</span> <span class="o">=</span> <span class="n">call_credential</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h3 id="luna.common.connectors.DremioDataframeConnector" class="doc doc-heading">
          <code>DremioDataframeConnector</code>


<a href="#luna.common.connectors.DremioDataframeConnector" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">

  
      <p>A connector that interfaces with a Dremio instance/cluster via Apache Arrow Flight for fast read performance
Parameters</p>
<hr />
<p>scheme: connection scheme
hostname: host of main dremio name
flightport: which port dremio exposes to flight requests
dremio_user: username to use
dremio_password: associated password
connection_args: anything else to pass to the FlightClient initialization</p>

            <details class="quote">
              <summary>Source code in <code>src/luna/common/connectors.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="k">class</span> <span class="nc">DremioDataframeConnector</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    A connector that interfaces with a Dremio instance/cluster via Apache Arrow Flight for fast read performance</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    Parameters</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    scheme: connection scheme</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    hostname: host of main dremio name</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    flightport: which port dremio exposes to flight requests</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    dremio_user: username to use</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    dremio_password: associated password</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    connection_args: anything else to pass to the FlightClient initialization</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">scheme</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">hostname</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">flightport</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">dremio_user</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="n">dremio_password</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">connection_args</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="p">):</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="c1"># Skipping tls...</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="c1"># Two WLM settings can be provided upon initial authneitcation</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="c1"># with the Dremio Server Flight Endpoint:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="c1"># - routing-tag</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="c1"># - routing queue</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">initial_options</span> <span class="o">=</span> <span class="n">flight</span><span class="o">.</span><span class="n">FlightCallOptions</span><span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="n">headers</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;routing-tag&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;test-routing-tag&quot;</span><span class="p">),</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;routing-queue&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;Low Cost User Queries&quot;</span><span class="p">),</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="p">]</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">client_auth_middleware</span> <span class="o">=</span> <span class="n">DremioClientAuthMiddlewareFactory</span><span class="p">()</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">flight</span><span class="o">.</span><span class="n">FlightClient</span><span class="p">(</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">flightport</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">middleware</span><span class="o">=</span><span class="p">[</span><span class="n">client_auth_middleware</span><span class="p">],</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="o">**</span><span class="n">connection_args</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="p">)</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bearer_token</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">authenticate_basic_token</span><span class="p">(</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="n">dremio_user</span><span class="p">,</span> <span class="n">dremio_password</span><span class="p">,</span> <span class="n">initial_options</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="c1"># print(&#39;[INFO] Authentication was successful&#39;)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">def</span> <span class="nf">get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        Return the virtual table at project(or &quot;space&quot;).table_name as a pandas dataframe</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        space: Project ID/Space to read from</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        table_name:  Table name to load</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">sqlquery</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; SELECT * FROM &quot;</span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s2">&quot;.&quot;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">sqlquery</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">def</span> <span class="nf">run_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sqlquery</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Return the virtual table at project(or &quot;space&quot;).table_name as a pandas dataframe</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        Parameters:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        ----------</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        project: Project ID to read from</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        table_name:  Table name to load</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="c1"># Get table from our dicom segments</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="c1"># flight_desc = flight.FlightDescriptor.for_command(sqlquery)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[INFO] Query: &quot;</span><span class="p">,</span> <span class="n">sqlquery</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">options</span> <span class="o">=</span> <span class="n">flight</span><span class="o">.</span><span class="n">FlightCallOptions</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bearer_token</span><span class="p">])</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="c1"># schema = self.client.get_schema(flight_desc, options)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="c1"># print(&#39;[INFO] GetSchema was successful&#39;)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="c1"># print(&#39;[INFO] Schema: &#39;, schema)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="c1"># Get the FlightInfo message to retrieve the Ticket corresponding</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="c1"># to the query result set.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">flight_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_flight_info</span><span class="p">(</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="n">flight</span><span class="o">.</span><span class="n">FlightDescriptor</span><span class="o">.</span><span class="n">for_command</span><span class="p">(</span><span class="n">sqlquery</span><span class="p">),</span> <span class="n">options</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="c1"># print(&#39;[INFO] GetFlightInfo was successful&#39;)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="c1"># print(&#39;[INFO] Ticket: &#39;, flight_info.endpoints[0].ticket)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="c1"># Retrieve the result set as a stream of Arrow record batches.</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">do_get</span><span class="p">(</span><span class="n">flight_info</span><span class="o">.</span><span class="n">endpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ticket</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="c1"># print(&#39;[INFO] Reading query results from Dremio&#39;)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">return</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_pandas</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h4 id="luna.common.connectors.DremioDataframeConnector.get_table" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_table</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span></code>

<a href="#luna.common.connectors.DremioDataframeConnector.get_table" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Return the virtual table at project(or "space").table_name as a pandas dataframe
Parameters:</p>
<hr />
<p>space: Project ID/Space to read from
table_name:  Table name to load</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/connectors.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span>
<span class="normal"><a href="#__codelineno-0-98">98</a></span>
<span class="normal"><a href="#__codelineno-0-99">99</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="k">def</span> <span class="nf">get_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    Return the virtual table at project(or &quot;space&quot;).table_name as a pandas dataframe</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    space: Project ID/Space to read from</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    table_name:  Table name to load</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">sqlquery</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot; SELECT * FROM &quot;</span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s2">&quot;.&quot;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_query</span><span class="p">(</span><span class="n">sqlquery</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.connectors.DremioDataframeConnector.run_query" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">run_query</span><span class="p">(</span><span class="n">sqlquery</span><span class="p">)</span></code>

<a href="#luna.common.connectors.DremioDataframeConnector.run_query" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Return the virtual table at project(or "space").table_name as a pandas dataframe
Parameters:</p>
<hr />
<p>project: Project ID to read from
table_name:  Table name to load</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/connectors.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="k">def</span> <span class="nf">run_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sqlquery</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    Return the virtual table at project(or &quot;space&quot;).table_name as a pandas dataframe</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    ----------</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    project: Project ID to read from</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    table_name:  Table name to load</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="c1"># Get table from our dicom segments</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="c1"># flight_desc = flight.FlightDescriptor.for_command(sqlquery)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[INFO] Query: &quot;</span><span class="p">,</span> <span class="n">sqlquery</span><span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">options</span> <span class="o">=</span> <span class="n">flight</span><span class="o">.</span><span class="n">FlightCallOptions</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bearer_token</span><span class="p">])</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="c1"># schema = self.client.get_schema(flight_desc, options)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="c1"># print(&#39;[INFO] GetSchema was successful&#39;)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="c1"># print(&#39;[INFO] Schema: &#39;, schema)</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="c1"># Get the FlightInfo message to retrieve the Ticket corresponding</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="c1"># to the query result set.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="n">flight_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_flight_info</span><span class="p">(</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">flight</span><span class="o">.</span><span class="n">FlightDescriptor</span><span class="o">.</span><span class="n">for_command</span><span class="p">(</span><span class="n">sqlquery</span><span class="p">),</span> <span class="n">options</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="c1"># print(&#39;[INFO] GetFlightInfo was successful&#39;)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="c1"># print(&#39;[INFO] Ticket: &#39;, flight_info.endpoints[0].ticket)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="c1"># Retrieve the result set as a stream of Arrow record batches.</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">do_get</span><span class="p">(</span><span class="n">flight_info</span><span class="o">.</span><span class="n">endpoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ticket</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="c1"># print(&#39;[INFO] Reading query results from Dremio&#39;)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">return</span> <span class="n">reader</span><span class="o">.</span><span class="n">read_pandas</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">




<h2 id="luna.common.dask" class="doc doc-heading">
          <code>dask</code>


<a href="#luna.common.dask" class="headerlink" title="Permanent link">&para;</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="luna.common.dask.configure_dask_client" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">configure_dask_client</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#luna.common.dask.configure_dask_client" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Instantiate a Dask client according to the given configuration.  This should only
be called once in a given program.  The client created here can always be retrieved
(where needed) using get_or_create_dask_client().</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/dask.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span> <span class="nf">configure_dask_client</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Instantiate a Dask client according to the given configuration.  This should only</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    be called once in a given program.  The client created here can always be retrieved</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    (where needed) using get_or_create_dask_client().</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="k">elif</span> <span class="n">scheduler</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">DASK_ADDRESS_VAR</span><span class="p">):</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_dask_address</span><span class="p">(</span><span class="n">scheduler</span><span class="p">):</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Env var </span><span class="si">{</span><span class="n">DASK_ADDRESS_VAR</span><span class="si">}</span><span class="s2"> has illegal value &#39;</span><span class="si">{</span><span class="n">scheduler</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="n">client</span> <span class="o">=</span> <span class="n">get_client</span><span class="p">(</span><span class="n">scheduler</span><span class="p">)</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>            <span class="n">client</span> <span class="o">=</span> <span class="n">get_client</span><span class="p">()</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error connecting to Dask scheduler.  Reverting to LocalCluster.</span><span class="se">\n</span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">threads_per_worker</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">return</span> <span class="n">client</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.dask.dask_job" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">dask_job</span><span class="p">(</span><span class="n">job_name</span><span class="p">)</span></code>

<a href="#luna.common.dask.dask_job" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>The simplier version of a dask job decorator, which only provides the worker_client as a runner to the calling function</p>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="nd">@dask_job</span><span class="p">(</span><span class="s1">&#39;my_job&#39;</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">my_job</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span>    <span class="n">runner</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">sleep</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/dask.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="k">def</span> <span class="nf">dask_job</span><span class="p">(</span><span class="n">job_name</span><span class="p">):</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    The simplier version of a dask job decorator, which only provides the worker_client as a runner to the calling function</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        &gt;&gt;&gt; @dask_job(&#39;my_job&#39;)</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        &gt;&gt;&gt; my_job(args, kwargs, runner=None):</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        &gt;&gt;&gt;     runner.submit(sleep, 10)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">def</span> <span class="nf">run_simple</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">            Only provides runner object to method, no threading</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="c1"># Tell us we are running</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initializing </span><span class="si">{</span><span class="n">job_name</span><span class="si">}</span><span class="s2"> @ </span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>            <span class="c1"># See if we are on a dask worker</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="n">worker</span> <span class="o">=</span> <span class="n">get_worker</span><span class="p">()</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not get dask worker!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>                <span class="n">worker</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unknown exception when getting dask worker&quot;</span><span class="p">)</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="n">worker</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully found worker </span><span class="si">{</span><span class="n">worker</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="c1"># Jobs get an output directory and an ouput parquet slice</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>            <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MIND_GPFS_DIR&quot;</span><span class="p">],</span> <span class="s2">&quot;data_dev&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">index</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="p">)</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="n">output_ds</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MIND_GPFS_DIR&quot;</span><span class="p">],</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="s2">&quot;data_dev&quot;</span><span class="p">,</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="n">namespace</span><span class="p">,</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>                <span class="n">job_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_DS&quot;</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_ds</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="n">output_segment</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_ds</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;ResultSegment-</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">.parquet&quot;</span><span class="p">)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setup ouput dir=</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2"> slice=</span><span class="si">{</span><span class="n">output_ds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="c1"># Kick off the job</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running job </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> with args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">, kwargs: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                <span class="n">return_value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">output_segment</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                    <span class="sa">f</span><span class="s2">&quot;Job execution failed due to: </span><span class="si">{</span><span class="n">exc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;namespace&quot;</span><span class="p">:</span> <span class="n">namespace</span><span class="p">,</span> <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">index</span><span class="p">},</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>                <span class="p">)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>                <span class="k">raise</span> <span class="n">JobExecutionError</span><span class="p">(</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>                    <span class="sa">f</span><span class="s2">&quot;Job </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> did not run successfully, please check input data! </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>                <span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="k">return</span> <span class="n">return_value</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="n">run_simple</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">job_name</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="k">return</span> <span class="n">run_simple</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">return</span> <span class="n">wrapped</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.dask.prune_empty_delayed" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">prune_empty_delayed</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span></code>

<a href="#luna.common.dask.prune_empty_delayed" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>A less-than-ideal method to prune empty tasks from dask tasks
Here we're trading CPU and time for memory.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>tasks</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of delayed dask tasks</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list[dask.delayed]: a reduced list of delayed dask tasks</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/dask.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="k">def</span> <span class="nf">prune_empty_delayed</span><span class="p">(</span><span class="n">tasks</span><span class="p">):</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    A less-than-ideal method to prune empty tasks from dask tasks</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Here we&#39;re trading CPU and time for memory.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        tasks (list): list of delayed dask tasks</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        list[dask.delayed]: a reduced list of delayed dask tasks</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="nd">@dask</span><span class="o">.</span><span class="n">delayed</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">def</span> <span class="nf">mock_return</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="k">return</span> <span class="n">task</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">LENGTH_MANY_TASKS</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hope you&#39;re okay with a length=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span><span class="si">}</span><span class="s2"> for loop!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">mock_return</span><span class="p">(</span><span class="n">task</span><span class="p">)</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">dask</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span> <span class="k">if</span> <span class="n">task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.dask.with_event_loop" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">with_event_loop</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

<a href="#luna.common.dask.with_event_loop" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>This method decorates functions run on dask workers with an async function call
Namely, this allows us to manage the execution of a function a bit better, and especially, to exit job execution if things take too long (1hr)</p>
<p>Here, the function func is run in a background thread, and has access to the dask schedular through the 'runner'.
Critically, sumbission to this runner/client looks the same regardless of if it occurs in a sub-process/thread</p>
<p>Mostly, this is a workaround to impliment some form of timeout when running very long-tasks on dask.
While one cannot (or should not) kill the running thread, Dask will cleanup the child tasks eventually once all jobs finish.</p>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="nd">@with_dask_event_loop</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">my_job</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span>    <span class="n">runner</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">sleep</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/dask.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="k">def</span> <span class="nf">with_event_loop</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    This method decorates functions run on dask workers with an async function call</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">    Namely, this allows us to manage the execution of a function a bit better, and especially, to exit job execution if things take too long (1hr)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    Here, the function func is run in a background thread, and has access to the dask schedular through the &#39;runner&#39;.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    Critically, sumbission to this runner/client looks the same regardless of if it occurs in a sub-process/thread</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    Mostly, this is a workaround to impliment some form of timeout when running very long-tasks on dask.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    While one cannot (or should not) kill the running thread, Dask will cleanup the child tasks eventually once all jobs finish.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        &gt;&gt;&gt; @with_dask_event_loop</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        &gt;&gt;&gt; my_job(args, kwargs, runner=None):</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        &gt;&gt;&gt;     runner.submit(sleep, 10)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="c1"># Get our current dask worker, functions wrapped with this method can only be run on dask workers</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing job... getting parent worker&quot;</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">worker</span> <span class="o">=</span> <span class="n">get_worker</span><span class="p">()</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not get dask worker!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Data-processing job called without parent dask worker&quot;</span><span class="p">)</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Unknown exception when getting dask worker&quot;</span><span class="p">)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully found worker </span><span class="si">{</span><span class="n">worker</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running job </span><span class="si">{</span><span class="n">func</span><span class="si">}</span><span class="s2"> with args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">, kwargs: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="c1"># Get our worker client, and pass as a dask client exector</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="k">with</span> <span class="n">worker_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">runner</span><span class="p">:</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="c1"># We&#39;ll run our function in a background thread</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="c1"># executor = ProcessPoolExecutor(max_workers=1)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="c1"># Add our runner to kwargs</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;runner&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runner</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="c1"># Kick off the job</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">job</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">executor</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="c1"># Move on from job if things take more than hour</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">done</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">([</span><span class="n">job</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="c1"># Do some cleanup</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Killing pending tasks!&quot;</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">pending</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>                    <span class="n">task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="c1"># executor.shutdown(wait=False)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="c1"># Get the return value</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="n">return_value</span> <span class="o">=</span> <span class="n">done</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>                <span class="n">return_value</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="c1"># Logg that we&#39;re done!</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done running job, returning </span><span class="si">{</span><span class="n">return_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">return</span> <span class="n">return_value</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">def</span> <span class="nf">run_loop</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        Uses async and threading capabilities</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        Use of background thread causes this error on shutdown:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">            ERROR - asyncio - task: &lt;Task pending coro=&lt;HTTP1ServerConnection._server_request_loop() running at /gpfs/mskmindhdp_emc/sw/env/lib64/python3.6/site-packages/tornado/http1connection.py:817&gt; wait_for=&lt;Future pending cb=[&lt;TaskWakeupMethWrapper object at 0x7f52e8259318&gt;()]&gt; cb=[IOLoop.add_future.&lt;locals&gt;.&lt;lambda&gt;() at /gpfs/mskmindhdp_emc/sw/env/lib64/python3.6/site-packages/tornado/ioloop.py:690]&gt;</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">            Seems like some async task gets hung up in the child thread...</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">new_event_loop</span><span class="p">()</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">




<h2 id="luna.common.stats" class="doc doc-heading">
          <code>stats</code>


<a href="#luna.common.stats" class="headerlink" title="Permanent link">&para;</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="luna.common.stats.compute_stats_1d" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">compute_stats_1d</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">fx_name_prefix</span><span class="p">,</span> <span class="n">n_percentiles</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

<a href="#luna.common.stats.compute_stats_1d" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Computes 1d (histogram)-like summary statistics</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vec</code></td>
          <td>
                <code><span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>a 1-d vector input</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fx_name_prefix</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Prefix for feature names</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n_percentiles</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of percentiles to compute, default 4 = 0 (min), 25, 50, 75, 100 (max)</p>
            </div>
          </td>
          <td>
                <code>4</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dict</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>summary statistics</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/stats.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="k">def</span> <span class="nf">compute_stats_1d</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">fx_name_prefix</span><span class="p">,</span> <span class="n">n_percentiles</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes 1d (histogram)-like summary statistics</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">        vec (np.array): a 1-d vector input</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">        fx_name_prefix (str): Prefix for feature names</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        n_percentiles (int): Number of percentiles to compute, default 4 = 0 (min), 25, 50, 75, 100 (max)</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        dict: summary statistics</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">n</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">sm</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">sk</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="c1"># ln_params = scipy.stats.lognorm.fit(vec, floc=0)</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">hist_features</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fx_name_prefix</span><span class="si">}</span><span class="s2">_nobs&quot;</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fx_name_prefix</span><span class="si">}</span><span class="s2">_mean&quot;</span><span class="p">:</span> <span class="n">sm</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fx_name_prefix</span><span class="si">}</span><span class="s2">_variance&quot;</span><span class="p">:</span> <span class="n">sv</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fx_name_prefix</span><span class="si">}</span><span class="s2">_skewness&quot;</span><span class="p">:</span> <span class="n">ss</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fx_name_prefix</span><span class="si">}</span><span class="s2">_kurtosis&quot;</span><span class="p">:</span> <span class="n">sk</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="c1"># f&#39;{fx_name_prefix}_lognorm_fit_p0&#39;: ln_params[0],</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="c1"># f&#39;{fx_name_prefix}_lognorm_fit_p2&#39;: ln_params[2]</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="p">}</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">percentiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">n_percentiles</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="k">for</span> <span class="n">percentile</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">percentiles</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">vec</span><span class="p">,</span> <span class="n">percentiles</span><span class="p">)):</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="n">hist_features</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fx_name_prefix</span><span class="si">}</span><span class="s2">_pct</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">percentile</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="k">return</span> <span class="n">hist_features</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">




<h2 id="luna.common.utils" class="doc doc-heading">
          <code>utils</code>


<a href="#luna.common.utils" class="headerlink" title="Permanent link">&para;</a></h2>

  <div class="doc doc-contents ">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h3 id="luna.common.utils.LunaCliCall" class="doc doc-heading">
          <code>LunaCliCall</code>


<a href="#luna.common.utils.LunaCliCall" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>src/luna/common/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="k">class</span> <span class="nc">LunaCliCall</span><span class="p">:</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cli_call</span><span class="p">,</span> <span class="n">cli_client</span><span class="p">):</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cli_call</span> <span class="o">=</span> <span class="n">cli_call</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cli_client</span> <span class="o">=</span> <span class="n">cli_client</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cli_call</span><span class="p">))</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_name</span><span class="p">):</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run (execute) CLI Call given a &#39;step_name&#39;, add step to parent CLI Client once completed.</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">            step_name (str): Name of the CLI call, determines output directory, can act as inputs to other CLI steps</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">step_name</span><span class="p">:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Cannot name steps with path-like character /&quot;</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="n">output_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_client</span><span class="o">.</span><span class="n">get_output_dir</span><span class="p">(</span><span class="n">step_name</span><span class="p">)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-o&quot;</span><span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cli_call</span><span class="p">)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cli_call</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cli_client</span><span class="o">.</span><span class="n">cli_steps</span><span class="p">[</span><span class="n">step_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_dir</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h4 id="luna.common.utils.LunaCliCall.run" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="n">step_name</span><span class="p">)</span></code>

<a href="#luna.common.utils.LunaCliCall.run" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Run (execute) CLI Call given a 'step_name', add step to parent CLI Client once completed.
Args:
    step_name (str): Name of the CLI call, determines output directory, can act as inputs to other CLI steps</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_name</span><span class="p">):</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run (execute) CLI Call given a &#39;step_name&#39;, add step to parent CLI Client once completed.</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a><span class="sd">        step_name (str): Name of the CLI call, determines output directory, can act as inputs to other CLI steps</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">step_name</span><span class="p">:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Cannot name steps with path-like character /&quot;</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="n">output_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_client</span><span class="o">.</span><span class="n">get_output_dir</span><span class="p">(</span><span class="n">step_name</span><span class="p">)</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-o&quot;</span><span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cli_call</span><span class="p">)</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cli_call</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cli_client</span><span class="o">.</span><span class="n">cli_steps</span><span class="p">[</span><span class="n">step_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_dir</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h3 id="luna.common.utils.LunaCliClient" class="doc doc-heading">
          <code>LunaCliClient</code>


<a href="#luna.common.utils.LunaCliClient" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">


            <details class="quote">
              <summary>Source code in <code>src/luna/common/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="k">class</span> <span class="nc">LunaCliClient</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize Luna CLI Client with a base directory (the root working directory) and a UUID to track results.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">            base_dir (str): parent working directory</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">            uuid (str): some unique string for this instance</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cli_steps</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">data_path</span><span class="p">):</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Add data  (boostrap a root CLI call).</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">            step_name (str): Name of the (boostrap) CLI call, determines output directory, can act as inputs to other CLI steps</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">            data_path (str): Input data path</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cli_steps</span><span class="p">[</span><span class="n">step_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cli_resource</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure a CLI step.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">            cli_resource (str): CLI Resource string like</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">            args (list): List of CLI arguements</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">            kwargs (list): List of CLI parameters</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">            LunaCliCall</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="n">cli_call</span> <span class="o">=</span> <span class="n">cli_resource</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_steps</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                <span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cli_steps</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">())</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>                <span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="k">return</span> <span class="n">LunaCliCall</span><span class="p">(</span><span class="n">cli_call</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>    <span class="k">def</span> <span class="nf">get_output_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_name</span><span class="p">):</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get output_dir based on base_dir, uuid, and step name.</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">            step_name (str): parent working directory</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">            output_dir (str)</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">step_name</span><span class="p">)</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="k">return</span> <span class="n">output_dir</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h4 id="luna.common.utils.LunaCliClient.__init__" class="doc doc-heading">
          <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">uuid</span><span class="p">)</span></code>

<a href="#luna.common.utils.LunaCliClient.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Initialize Luna CLI Client with a base directory (the root working directory) and a UUID to track results.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>base_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>parent working directory</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>uuid</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>some unique string for this instance</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_dir</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize Luna CLI Client with a base directory (the root working directory) and a UUID to track results.</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="sd">        base_dir (str): parent working directory</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">        uuid (str): some unique string for this instance</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">base_dir</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cli_steps</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.utils.LunaCliClient.bootstrap" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">bootstrap</span><span class="p">(</span><span class="n">step_name</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span></code>

<a href="#luna.common.utils.LunaCliClient.bootstrap" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Add data  (boostrap a root CLI call).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>step_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the (boostrap) CLI call, determines output directory, can act as inputs to other CLI steps</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>data_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Input data path</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="k">def</span> <span class="nf">bootstrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">data_path</span><span class="p">):</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add data  (boostrap a root CLI call).</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">        step_name (str): Name of the (boostrap) CLI call, determines output directory, can act as inputs to other CLI steps</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a><span class="sd">        data_path (str): Input data path</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cli_steps</span><span class="p">[</span><span class="n">step_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.utils.LunaCliClient.configure" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">configure</span><span class="p">(</span><span class="n">cli_resource</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#luna.common.utils.LunaCliClient.configure" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Configure a CLI step.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cli_resource</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>CLI Resource string like</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>args</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of CLI arguements</p>
            </div>
          </td>
          <td>
                <code>()</code>
          </td>
        </tr>
        <tr>
          <td><code>kwargs</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of CLI parameters</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns:
    LunaCliCall</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cli_resource</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configure a CLI step.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">        cli_resource (str): CLI Resource string like</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">        args (list): List of CLI arguements</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">        kwargs (list): List of CLI parameters</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">        LunaCliCall</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>    <span class="n">cli_call</span> <span class="o">=</span> <span class="n">cli_resource</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>        <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_steps</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cli_steps</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">())</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>            <span class="n">cli_call</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="k">return</span> <span class="n">LunaCliCall</span><span class="p">(</span><span class="n">cli_call</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h4 id="luna.common.utils.LunaCliClient.get_output_dir" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_output_dir</span><span class="p">(</span><span class="n">step_name</span><span class="p">)</span></code>

<a href="#luna.common.utils.LunaCliClient.get_output_dir" class="headerlink" title="Permanent link">&para;</a></h4>


  <div class="doc doc-contents ">
  
      <p>Get output_dir based on base_dir, uuid, and step name.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>step_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>parent working directory</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns:
    output_dir (str)</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="k">def</span> <span class="nf">get_output_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step_name</span><span class="p">):</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get output_dir based on base_dir, uuid, and step name.</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">        step_name (str): parent working directory</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">        output_dir (str)</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="n">step_name</span><span class="p">)</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="k">return</span> <span class="n">output_dir</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>



<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.apply_csv_filter" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">apply_csv_filter</span><span class="p">(</span><span class="n">input_paths</span><span class="p">,</span> <span class="n">subset_csv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="p">{})</span></code>

<a href="#luna.common.utils.apply_csv_filter" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Filters a list of input_paths based on include/exclude logic given for either the full path, filename, or filestem.</p>
<p>If using "include" logic, only matching entries with include=True are kept.
If using "exclude" logic, only matching entries with exclude=True are removed.</p>
<p>The origional list is returned if the given subset_csv is None or empty.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_paths</code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>list of input paths to filter</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>subset_csv</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to a csv with subset/filter information/flags</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns
    list[str]: filtered list
Raises:
    RuntimeError: If the given subset_csv is invalid</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="k">def</span> <span class="nf">apply_csv_filter</span><span class="p">(</span><span class="n">input_paths</span><span class="p">,</span> <span class="n">subset_csv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="p">{}):</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Filters a list of input_paths based on include/exclude logic given for either the full path, filename, or filestem.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">    If using &quot;include&quot; logic, only matching entries with include=True are kept.</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">    If using &quot;exclude&quot; logic, only matching entries with exclude=True are removed.</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    The origional list is returned if the given subset_csv is None or empty.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">        input_paths (list[str]): list of input paths to filter</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">        subset_csv (str): path to a csv with subset/filter information/flags</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    Returns</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">        list[str]: filtered list</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">        RuntimeError: If the given subset_csv is invalid</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset_csv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">subset_csv</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="k">return</span> <span class="n">input_paths</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">subset_csv</span><span class="p">):</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="k">return</span> <span class="n">input_paths</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="n">subset_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="n">subset_csv</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span> <span class="n">storage_options</span><span class="o">=</span><span class="n">storage_options</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="p">)</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="n">match_type</span> <span class="o">=</span> <span class="n">subset_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="n">filter_logic</span> <span class="o">=</span> <span class="n">subset_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="k">if</span> <span class="n">match_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;stem&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid match type column&quot;</span><span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="k">if</span> <span class="n">filter_logic</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;include&quot;</span><span class="p">,</span> <span class="s2">&quot;exclude&quot;</span><span class="p">]:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid match type column&quot;</span><span class="p">)</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="s2">&quot;Invalid subset .csv passed, must be a 2-column csv with headers = [ (path|filename|stem), (include|exclude) ]&quot;</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="p">)</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset_df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="k">return</span> <span class="n">input_paths</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="sa">f</span><span class="s2">&quot;Applying csv filter, match_type=</span><span class="si">{</span><span class="n">match_type</span><span class="si">}</span><span class="s2">, filter_logic=</span><span class="si">{</span><span class="n">filter_logic</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="p">)</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="n">input_path_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="p">{</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;stem&quot;</span><span class="p">:</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="p">}</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">input_paths</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="n">df_matches</span> <span class="o">=</span> <span class="n">input_path_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">match_type</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="n">subset_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">match_type</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="p">)</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>    <span class="k">if</span> <span class="n">filter_logic</span> <span class="o">==</span> <span class="s2">&quot;include&quot;</span><span class="p">:</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">df_matches</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df_matches</span><span class="p">[</span><span class="s2">&quot;include&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>    <span class="k">if</span> <span class="n">filter_logic</span> <span class="o">==</span> <span class="s2">&quot;exclude&quot;</span><span class="p">:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">df_matches</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_matches</span><span class="p">[</span><span class="s2">&quot;exclude&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.generate_uuid" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_uuid</span><span class="p">(</span><span class="n">urlpath</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="p">{})</span></code>

<a href="#luna.common.utils.generate_uuid" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Returns hash of the file given path, preceded by the prefix.
:param path: file path e.g. file:/path/to/file
:param prefix: list e.g. ["SVGEOJSON","default-label"]
:return: string uuid</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="k">def</span> <span class="nf">generate_uuid</span><span class="p">(</span><span class="n">urlpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">storage_options</span><span class="o">=</span><span class="p">{}):</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    Returns hash of the file given path, preceded by the prefix.</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    :param path: file path e.g. file:/path/to/file</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    :param prefix: list e.g. [&quot;SVGEOJSON&quot;,&quot;default-label&quot;]</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">    :return: string uuid</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="n">fs</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">url_to_fs</span><span class="p">(</span><span class="n">urlpath</span><span class="p">,</span> <span class="o">**</span><span class="n">storage_options</span><span class="p">)</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="n">rec_hash</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">checksum</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec_hash</span><span class="p">)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="k">return</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.generate_uuid_binary" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_uuid_binary</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span></code>

<a href="#luna.common.utils.generate_uuid_binary" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Returns hash of the binary, preceded by the prefix.
:param content: binary
:param prefix: list e.g. ["FEATURE"]
:return: string uuid</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="k">def</span> <span class="nf">generate_uuid_binary</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    Returns hash of the binary, preceded by the prefix.</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    :param content: binary</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    :param prefix: list e.g. [&quot;FEATURE&quot;]</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    :return: string uuid</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="s2">&quot;generate_uuid_binary() should not be used anymore, the UUIDs generated are not valid!&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="p">)</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="n">content</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="n">uuid</span> <span class="o">=</span> <span class="s2">&quot;00000000&quot;</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="k">return</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.generate_uuid_dict" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_uuid_dict</span><span class="p">(</span><span class="n">json_str</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span></code>

<a href="#luna.common.utils.generate_uuid_dict" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Returns hash of the json string, preceded by the prefix.
:param json_str: str representation of json
:param prefix: list e.g. ["SVGEOJSON","default-label"]
:return: v</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="k">def</span> <span class="nf">generate_uuid_dict</span><span class="p">(</span><span class="n">json_str</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    Returns hash of the json string, preceded by the prefix.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    :param json_str: str representation of json</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    :param prefix: list e.g. [&quot;SVGEOJSON&quot;,&quot;default-label&quot;]</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    :return: v</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="c1"># json_bytes = json.dumps(json_str).encode(&quot;utf-8&quot;)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="s2">&quot;generate_uuid_dict() should not be used anymore, the UUIDs generated are not valid!&quot;</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="p">)</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">uuid</span> <span class="o">=</span> <span class="s2">&quot;00000000&quot;</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="k">return</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.get_absolute_path" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_absolute_path</span><span class="p">(</span><span class="n">module_path</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">)</span></code>

<a href="#luna.common.utils.get_absolute_path" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Given the path to a module file and the path, relative to the module file, of another file
that needs to be referenced in the module, this method returns the absolute path of the file
that needs to be referenced.</p>
<p>This method makes it possible to resolve absolute paths to files in any environment a
module and the referenced files are deployed to.</p>
<p>:param module_path path to the module. Use '<strong>file</strong>' from the module.
:param relative_path path to the file that needs to be referenced by the module. The path must
be relative to the module.
:return absolute path to file with the specified relative_path</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="k">def</span> <span class="nf">get_absolute_path</span><span class="p">(</span><span class="n">module_path</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">):</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Given the path to a module file and the path, relative to the module file, of another file</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">    that needs to be referenced in the module, this method returns the absolute path of the file</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    that needs to be referenced.</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    This method makes it possible to resolve absolute paths to files in any environment a</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    module and the referenced files are deployed to.</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    :param module_path path to the module. Use &#39;__file__&#39; from the module.</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    :param relative_path path to the file that needs to be referenced by the module. The path must</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">    be relative to the module.</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    :return absolute path to file with the specified relative_path</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">module_path</span><span class="p">),</span> <span class="n">relative_path</span><span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="c1"># resolve any back-paths with ../ to simplify absolute path</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.get_config" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_config</span><span class="p">(</span><span class="n">cli_kwargs</span><span class="p">)</span></code>

<a href="#luna.common.utils.get_config" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Get the config with merged OmegaConf files</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cli_kwargs</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>CLI keyword arguments</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="n">cli_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the config with merged OmegaConf files</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">        cli_kwargs (dict): CLI keyword arguments</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="n">configs</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Union[ListConfig, DictConfig]]</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="n">cli_conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">cli_kwargs</span><span class="p">)</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="n">configs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cli_conf</span><span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="c1"># Get params from param file</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="k">if</span> <span class="n">cli_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;local_config&quot;</span><span class="p">):</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cli_conf</span><span class="o">.</span><span class="n">local_config</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">cli_conf</span><span class="o">.</span><span class="n">storage_options</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="n">local_conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="n">configs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">local_conf</span><span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="n">merged_conf</span> <span class="o">=</span> <span class="n">OmegaConf</span><span class="o">.</span><span class="n">to_container</span><span class="p">(</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="n">OmegaConf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="o">*</span><span class="n">configs</span><span class="p">),</span> <span class="n">resolve</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">throw_on_missing</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="p">)</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="k">except</span> <span class="n">MissingMandatoryValue</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="k">raise</span> <span class="n">fire</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FireError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="k">if</span> <span class="n">merged_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_urlpath&quot;</span><span class="p">):</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="n">o</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">merged_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_urlpath&quot;</span><span class="p">)))</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">merged_conf</span><span class="p">[</span><span class="s2">&quot;output_filesystem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;file&quot;</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">scheme</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="n">merged_conf</span><span class="p">[</span><span class="s2">&quot;output_filesystem&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">scheme</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="k">if</span> <span class="n">merged_conf</span><span class="p">[</span><span class="s2">&quot;output_filesystem&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;file&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">merged_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="s2">&quot;output_storage_options&quot;</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="p">):</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="n">merged_conf</span><span class="p">[</span><span class="s2">&quot;output_storage_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>                <span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="p">{}</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="p">)</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="k">if</span> <span class="n">merged_conf</span><span class="p">[</span><span class="s2">&quot;output_filesystem&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">merged_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="s2">&quot;output_storage_options&quot;</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="p">):</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="n">merged_conf</span><span class="p">[</span><span class="s2">&quot;output_storage_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;auto_mkdir&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">return</span> <span class="n">merged_conf</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.get_dataset_url" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_dataset_url</span><span class="p">()</span></code>

<a href="#luna.common.utils.get_dataset_url" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Retrieve a "dataset URL" from the environment, may look like http://localhost:6077 or file:///absolute/path/to/dataset/dir</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="k">def</span> <span class="nf">get_dataset_url</span><span class="p">():</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve a &quot;dataset URL&quot; from the environment, may look like http://localhost:6077 or file:///absolute/path/to/dataset/dir&quot;&quot;&quot;</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="n">dataset_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DATASET_URL&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="k">if</span> <span class="n">dataset_url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="s2">&quot;Requesting feature data be sent to dataset, however no dataset URL provided, please set env DATASET_URL!&quot;</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found dataset URL = </span><span class="si">{</span><span class="n">dataset_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">return</span> <span class="n">dataset_url</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.grouper" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">grouper</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></code>

<a href="#luna.common.utils.grouper" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Turn an iterable into an iterable of iterables</p>
<p>'None' should not be a member of the input iterable as it is removed to handle the fillvalues</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>iterable</code></td>
          <td>
                <code>iterable</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>an iterable</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>n</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>sie of chunks</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>iterable[iterable]</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="k">def</span> <span class="nf">grouper</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Turn an iterable into an iterable of iterables</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">    &#39;None&#39; should not be a member of the input iterable as it is removed to handle the fillvalues</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        iterable (iterable): an iterable</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        n (int): sie of chunks</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        fillvalue</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        iterable[iterable]</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)]</span> <span class="o">*</span> <span class="n">n</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">iterable</span> <span class="k">if</span> <span class="n">entry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">for</span> <span class="n">iterable</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">zip_longest</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.load_func" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load_func</span><span class="p">(</span><span class="n">dotpath</span><span class="p">)</span></code>

<a href="#luna.common.utils.load_func" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Load function in module from a parsed yaml string.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dotpath</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>module/function name written as a string (ie torchvision.models.resnet34)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns:
    The inferred module itself, not the string representation</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="k">def</span> <span class="nf">load_func</span><span class="p">(</span><span class="n">dotpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load function in module from a parsed yaml string.</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">        dotpath (str): module/function name written as a string (ie torchvision.models.resnet34)</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">        The inferred module itself, not the string representation</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="n">module_</span><span class="p">,</span> <span class="n">func</span> <span class="o">=</span> <span class="n">dotpath</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>    <span class="n">m</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">module_</span><span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.local_cache_urlpath" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">local_cache_urlpath</span><span class="p">(</span><span class="n">file_key_write_mode</span><span class="o">=</span><span class="p">{},</span> <span class="n">dir_key_write_mode</span><span class="o">=</span><span class="p">{})</span></code>

<a href="#luna.common.utils.local_cache_urlpath" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Decorator for caching url/paths locally</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="k">def</span> <span class="nf">local_cache_urlpath</span><span class="p">(</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="n">file_key_write_mode</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="n">dir_key_write_mode</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="p">):</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator for caching url/paths locally&quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">args_dict</span> <span class="o">=</span> <span class="n">_get_args_dict</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">new_args_dict</span> <span class="o">=</span> <span class="n">args_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">tmp_dir_dest</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">write_mode</span> <span class="ow">in</span> <span class="n">dir_key_write_mode</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args_dict</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">args_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>                    <span class="k">continue</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>                <span class="n">storage_options_key</span> <span class="o">=</span> <span class="s2">&quot;storage_options&quot;</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="k">if</span> <span class="s2">&quot;w&quot;</span> <span class="ow">in</span> <span class="n">write_mode</span><span class="p">:</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>                    <span class="n">storage_options_key</span> <span class="o">=</span> <span class="s2">&quot;output_storage_options&quot;</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="n">fs</span><span class="p">,</span> <span class="nb">dir</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">url_to_fs</span><span class="p">(</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>                    <span class="n">args_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="o">**</span><span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">storage_options_key</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="p">)</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="k">if</span> <span class="n">fs</span><span class="o">.</span><span class="n">protocol</span> <span class="o">!=</span> <span class="s2">&quot;file&quot;</span> <span class="ow">and</span> <span class="s2">&quot;cache&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fs</span><span class="o">.</span><span class="n">protocol</span><span class="p">:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                    <span class="n">new_args_dict</span><span class="p">[</span><span class="n">storage_options_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;auto_mkdir&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>                    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>                    <span class="n">new_args_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_dir</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>                    <span class="n">tmp_dir_dest</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">fs</span><span class="p">))</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="k">with</span> <span class="n">ExitStack</span><span class="p">()</span> <span class="k">as</span> <span class="n">stack</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">write_mode</span> <span class="ow">in</span> <span class="n">file_key_write_mode</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args_dict</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">args_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>                        <span class="k">continue</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>                    <span class="n">storage_options_key</span> <span class="o">=</span> <span class="s2">&quot;storage_options&quot;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>                    <span class="k">if</span> <span class="s2">&quot;w&quot;</span> <span class="ow">in</span> <span class="n">write_mode</span><span class="p">:</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>                        <span class="n">storage_options_key</span> <span class="o">=</span> <span class="s2">&quot;output_storage_options&quot;</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>                    <span class="n">fs</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">url_to_fs</span><span class="p">(</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>                        <span class="n">args_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="o">**</span><span class="n">args_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">storage_options_key</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>                    <span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>                    <span class="k">if</span> <span class="s2">&quot;cache&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fs</span><span class="o">.</span><span class="n">protocol</span><span class="p">:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>                        <span class="n">simplecache_fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span><span class="s2">&quot;simplecache&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>                        <span class="n">of</span> <span class="o">=</span> <span class="n">simplecache_fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">write_mode</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>                        <span class="n">stack</span><span class="o">.</span><span class="n">enter_context</span><span class="p">(</span><span class="n">of</span><span class="p">)</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>                        <span class="n">new_args_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">of</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">new_args_dict</span><span class="p">)</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">for</span> <span class="n">tmp_dir</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">tmp_dir_dest</span><span class="p">:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="n">copy_files</span><span class="p">(</span><span class="n">tmp_dir</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">destination_filesystem</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="k">return</span> <span class="n">wrapper</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.post_to_dataset" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">post_to_dataset</span><span class="p">(</span><span class="n">input_feature_data</span><span class="p">,</span> <span class="n">waystation_url</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span></code>

<a href="#luna.common.utils.post_to_dataset" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Interface feature data to a parquet dataset.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_feature_data</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>path to input data</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>waystation_url</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>URL of dataset root (either file or using waystation)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dataset_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dataset name/ID</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>keys</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>corresponding segment keys</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="k">def</span> <span class="nf">post_to_dataset</span><span class="p">(</span><span class="n">input_feature_data</span><span class="p">,</span> <span class="n">waystation_url</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Interface feature data to a parquet dataset.</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        input_feature_data (str): path to input data</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">        waystation_url (str): URL of dataset root (either file or using waystation)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        dataset_id (str): Dataset name/ID</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        keys (dict): corresponding segment keys</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding </span><span class="si">{</span><span class="n">input_feature_data</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dataset_id</span><span class="si">}</span><span class="s2"> via </span><span class="si">{</span><span class="n">waystation_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>    <span class="n">segment_id</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keys</span><span class="o">.</span><span class="n">items</span><span class="p">())])</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SEGMENT_ID=</span><span class="si">{</span><span class="n">segment_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="n">post_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="n">waystation_url</span><span class="p">,</span> <span class="s2">&quot;datasets&quot;</span><span class="p">,</span> <span class="n">dataset_id</span><span class="p">,</span> <span class="s2">&quot;segments&quot;</span><span class="p">,</span> <span class="n">segment_id</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="p">)</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="n">post_url</span><span class="p">)</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="k">if</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="c1"># The cool way, using luna waystation</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Posting to: </span><span class="si">{</span><span class="n">post_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="n">post_url</span><span class="p">,</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;segment_data&quot;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_feature_data</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)},</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;segment_keys&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">keys</span><span class="p">)},</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="k">elif</span> <span class="s2">&quot;file&quot;</span> <span class="ow">in</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="p">:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="c1"># The less cool way, just using file paths</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="n">segment_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing to: </span><span class="si">{</span><span class="n">segment_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">segment_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">input_feature_data</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;SEGMENT_ID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment_id</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">re_indexors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;SEGMENT_ID&quot;</span><span class="p">]</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="k">if</span> <span class="n">keys</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">keys</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>                <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>                <span class="n">re_indexors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="n">re_indexors</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>  <span class="c1"># a trick to move columns to the left</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="n">data</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">segment_dir</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;data.parquet&quot;</span><span class="p">))</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unrecognized scheme: </span><span class="si">{parsed_url.scheme}</span><span class="s2">, skipping!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.save_metadata" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save_metadata</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

<a href="#luna.common.utils.save_metadata" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>This decorator saves metadata in output_url</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="k">def</span> <span class="nf">save_metadata</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This decorator saves metadata in output_url&quot;&quot;&quot;</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">(</span><span class="n">_get_args_dict</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span> <span class="o">|</span> <span class="n">result</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>            <span class="k">if</span> <span class="s2">&quot;output_urlpath&quot;</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>                <span class="n">o</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;output_urlpath&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>                <span class="n">fs</span> <span class="o">=</span> <span class="n">fsspec</span><span class="o">.</span><span class="n">filesystem</span><span class="p">(</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>                    <span class="n">o</span><span class="o">.</span><span class="n">scheme</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_storage_options&quot;</span><span class="p">,</span> <span class="p">{})</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>                <span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>                <span class="k">with</span> <span class="n">fs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">netloc</span> <span class="o">+</span> <span class="n">o</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;metadata.yml&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                    <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">return</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.timed" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">timed</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

<a href="#luna.common.utils.timed" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>This decorator prints the execution time for the decorated function.</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="k">def</span> <span class="nf">timed</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This decorator prints the execution time for the decorated function.&quot;&quot;&quot;</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> ran in </span><span class="si">{}</span><span class="s2">s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">return</span> <span class="n">result</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="luna.common.utils.validate_dask_address" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">validate_dask_address</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span></code>

<a href="#luna.common.utils.validate_dask_address" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Return True if <code>addr</code> appears to be a valid address for a dask scheduler.</p>
<p>The typical format for this will be something like 'tcp://192.168.0.37:8786',
but there could be a hostname instead of an IP address, and maybe some other
URL schemes are supported.  This function will be used to check whether a
user-defined dask scheduler address is plausible, or obviously invalid.</p>

          <details class="quote">
            <summary>Source code in <code>src/luna/common/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="k">def</span> <span class="nf">validate_dask_address</span><span class="p">(</span><span class="n">addr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    Return True if `addr` appears to be a valid address for a dask scheduler.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    The typical format for this will be something like &#39;tcp://192.168.0.37:8786&#39;,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    but there could be a hostname instead of an IP address, and maybe some other</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    URL schemes are supported.  This function will be used to check whether a</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    user-defined dask scheduler address is plausible, or obviously invalid.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">HOSTPORT_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;^(?P&lt;scheme&gt; tcp):</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        // (?P&lt;host&gt;\d{1,3}[.]\d{1,3}[.]\d{1,3}[.]\d{1,3} |</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">           [A-Za-z][A-Za-z0-9.-]*[A-Za-z0-9] |</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">           [A-Za-z])</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">         : (?P&lt;port&gt;\d+)$&quot;&quot;&quot;</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="p">)</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">HOSTPORT_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>


  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../../cli_reference/radiology/xnat_etl/" class="md-footer__link md-footer__link--prev" aria-label="Previous: xnat_etl" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              xnat_etl
            </div>
          </div>
        </a>
      
      
        
        <a href="../pathology/" class="md-footer__link md-footer__link--next" aria-label="Next: Luna Pathology" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Luna Pathology
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "instant", "tabs"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>